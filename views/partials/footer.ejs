<footer class="mc-footer">
  <div class="mc-footer__inner">
    <div class="mc-footer__brand">
      <span class="mc-logo__mark">MC</span>
      <span class="mc-logo__text">RankTiers</span>
    </div>
    <div class="mc-footer__links">
      <a href="/terms">Terms</a>
      <span aria-hidden="true">•</span>
      <a href="/privacy">Privacy</a>
      <span aria-hidden="true">•</span>
      <a href="<%= discordInvite %>" target="_blank" rel="noopener">Discord</a>
    </div>
    <p class="mc-footer__copy">© <%= new Date().getFullYear() %> RankTiers. Crafted for the Minecraft competitive scene.</p>
  </div>
</footer>
<script>
  const navToggle = document.querySelector('[data-nav-toggle]');
  const navContent = document.querySelector('[data-nav-content]');
  const navInner = document.querySelector('.mc-nav__inner');
  const reduceMotion = window.matchMedia
    ? window.matchMedia('(prefers-reduced-motion: reduce)')
    : { matches: false };

  function setNavOpen(open) {
    if (navToggle) {
      navToggle.setAttribute('aria-expanded', String(open));
    }
    navContent?.classList.toggle('is-open', open);
    document.body.classList.toggle('mc-nav-open', open);
  }

  setNavOpen(false);

  if (navToggle) {
    navToggle.addEventListener('click', event => {
      event.stopPropagation();
      const expanded = navToggle.getAttribute('aria-expanded') === 'true';
      setNavOpen(!expanded);
    });
  }

  navContent?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => setNavOpen(false));
  });

  document.addEventListener('keydown', event => {
    if (event.key === 'Escape') {
      setNavOpen(false);
    }
  });

  document.addEventListener(
    'click',
    event => {
      if (!document.body.classList.contains('mc-nav-open')) {
        return;
      }
      if (navInner?.contains(event.target)) {
        return;
      }
      setNavOpen(false);
    },
    { capture: true }
  );

  const navLinks = document.querySelector('[data-nav-links]');
  const navAuth = document.querySelector('[data-nav-auth]');
  const navUtilities = document.querySelector('[data-nav-utilities]');
  if (navToggle) {
    navToggle.addEventListener('click', () => {
      const expanded = navToggle.getAttribute('aria-expanded') === 'true';
      navToggle.setAttribute('aria-expanded', String(!expanded));
      navLinks?.classList.toggle('is-open', !expanded);
      navAuth?.classList.toggle('is-open', !expanded);
      navUtilities?.classList.toggle('is-open', !expanded);
    });
  }

  const copyButtons = document.querySelectorAll('[data-copy-text]');
  let toastStack = document.querySelector('.mc-toast-stack');

  function ensureToastStack() {
    if (!toastStack) {
      toastStack = document.createElement('div');
      toastStack.className = 'mc-toast-stack';
      toastStack.setAttribute('role', 'status');
      toastStack.setAttribute('aria-live', 'polite');
      document.body.appendChild(toastStack);
    }
    return toastStack;
  }

  function showToast(message, isError = false) {
    const stack = ensureToastStack();
    const toast = document.createElement('div');
    toast.className = `mc-toast${isError ? ' is-error' : ''}`;
    toast.textContent = message;
    stack.appendChild(toast);
    requestAnimationFrame(() => {
      toast.classList.add('is-visible');
    });
    setTimeout(() => {
      toast.classList.remove('is-visible');
      setTimeout(() => toast.remove(), 200);
    }, 2400);
  }

  async function copyToClipboard(text) {
    try {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
      } else {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.setAttribute('readonly', '');
        textarea.style.position = 'absolute';
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        textarea.remove();
      }
      return true;
    } catch (error) {
      console.error('Failed to copy text', error);
      return false;
    }
  }

  copyButtons.forEach(button => {
    button.addEventListener('click', async () => {
      const text = button.getAttribute('data-copy-text');
      if (!text) return;
      const success = await copyToClipboard(text);
      if (success) {
        button.classList.add('is-success');
        showToast(button.getAttribute('data-toast') || 'Copied to clipboard');
        setTimeout(() => button.classList.remove('is-success'), 1500);
      } else {
        showToast('Unable to copy text', true);
      }
    });
  });

  let scrollTopButton = document.querySelector('.mc-scroll-top');
  if (!scrollTopButton) {
    scrollTopButton = document.createElement('button');
    scrollTopButton.type = 'button';
    scrollTopButton.className = 'mc-scroll-top';
    scrollTopButton.setAttribute('aria-label', 'Back to top');
    scrollTopButton.innerHTML = `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="m6 15 6-6 6 6" />
      </svg>
    `;
    document.body.appendChild(scrollTopButton);
  }

  const updateScrollButton = () => {
    const shouldShow = window.scrollY > 420;
    scrollTopButton.classList.toggle('is-visible', shouldShow);
  };

  updateScrollButton();
  window.addEventListener('scroll', updateScrollButton, { passive: true });

  scrollTopButton.addEventListener('click', () => {
    if (reduceMotion.matches) {
      window.scrollTo(0, 0);
    } else {
  const scrollProgress = document.createElement('div');
  scrollProgress.className = 'mc-scroll-progress';
  document.body.appendChild(scrollProgress);

  const backToTop = document.createElement('button');
  backToTop.type = 'button';
  backToTop.className = 'mc-back-to-top';
  backToTop.setAttribute('aria-label', 'Scroll back to top');
  backToTop.innerHTML = '<span aria-hidden="true">↑</span>';
  document.body.appendChild(backToTop);

  backToTop.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  const quickNavTrigger = document.querySelector('[data-quick-nav-trigger]');
  const quickNavPanel = document.querySelector('[data-quick-nav-panel]');
  let quickNavLastActive = null;

  function toggleBackToTopVisibility(show) {
    backToTop.classList.toggle('is-visible', show);
  }

  function updateScrollUI() {
    const scrollElement = document.documentElement;
    const scrollTop = scrollElement.scrollTop || document.body.scrollTop;
    const scrollHeight = scrollElement.scrollHeight - scrollElement.clientHeight;
    const progress = scrollHeight > 0 ? scrollTop / scrollHeight : 0;
    const clamped = Math.max(0, Math.min(1, progress));
    scrollProgress.style.transform = `scaleX(${clamped})`;
    scrollProgress.setAttribute('aria-hidden', clamped <= 0 ? 'true' : 'false');
    toggleBackToTopVisibility(scrollTop > scrollElement.clientHeight * 0.75);
  }

  window.addEventListener('scroll', updateScrollUI, { passive: true });
  window.addEventListener('resize', updateScrollUI);
  updateScrollUI();

  function openQuickNav() {
    if (!quickNavPanel || quickNavPanel.classList.contains('is-open')) return;
    quickNavLastActive = document.activeElement;
    quickNavPanel.hidden = false;
    requestAnimationFrame(() => {
      quickNavPanel.classList.add('is-open');
      quickNavTrigger?.setAttribute('aria-expanded', 'true');
      const firstLink = quickNavPanel.querySelector('.mc-quick-menu__links a');
      firstLink?.focus();
    });
  }

  function closeQuickNav() {
    if (!quickNavPanel) return;
    quickNavPanel.classList.remove('is-open');
    quickNavTrigger?.setAttribute('aria-expanded', 'false');
    setTimeout(() => {
      quickNavPanel.hidden = true;
      if (quickNavLastActive && typeof quickNavLastActive.focus === 'function') {
        quickNavLastActive.focus();
      }
    }, 180);
  }

  quickNavTrigger?.addEventListener('click', () => {
    if (quickNavPanel?.classList.contains('is-open')) {
      closeQuickNav();
    } else {
      openQuickNav();
    }
  });

  quickNavPanel?.addEventListener('click', event => {
    if (event.target === quickNavPanel) {
      closeQuickNav();
    }
  });

  quickNavPanel?.querySelectorAll('[data-quick-nav-close]').forEach(closeButton => {
    closeButton.addEventListener('click', closeQuickNav);
  });

  quickNavPanel?.addEventListener('keydown', event => {
    if (event.key !== 'Tab') return;
    const focusable = quickNavPanel.querySelectorAll('a, button');
    if (!focusable.length) return;
    const first = focusable[0];
    const last = focusable[focusable.length - 1];
    if (event.shiftKey && document.activeElement === first) {
      event.preventDefault();
      last.focus();
    } else if (!event.shiftKey && document.activeElement === last) {
      event.preventDefault();
      first.focus();
    }
  });

  const interactiveSelectors = ['input', 'textarea', 'select', '[contenteditable="true"]'];

  document.addEventListener('keydown', event => {
    const target = event.target;
    const isTypingContext = interactiveSelectors.some(sel => target instanceof Element && target.closest(sel));
    if (
      event.key === '/' &&
      !event.shiftKey &&
      !event.ctrlKey &&
      !event.metaKey &&
      !event.altKey &&
      !isTypingContext &&
      !quickNavPanel?.classList.contains('is-open')
    ) {
      event.preventDefault();
      showToast('Opening search…');
      setTimeout(() => {
        window.location.href = '/search';
      }, 200);
    }

    if ((event.key === '?' || (event.key === '/' && event.shiftKey)) && !event.ctrlKey && !event.metaKey && !event.altKey) {
      if (!isTypingContext) {
        event.preventDefault();
        if (quickNavPanel?.classList.contains('is-open')) {
          closeQuickNav();
        } else {
          openQuickNav();
          showToast('Quick menu opened');
        }
      }
    }

    if (event.key === 'Escape' && quickNavPanel?.classList.contains('is-open')) {
      event.preventDefault();
      closeQuickNav();
    }

    if (event.key.toLowerCase() === 'b' && !event.ctrlKey && !event.metaKey && !event.altKey && !event.shiftKey && !isTypingContext) {
      event.preventDefault();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  });
</script>
